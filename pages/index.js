import Head from "next/head";
import { useEffect } from "react";
import Image from "next/image";
import { useState } from "react";
//import { useRouter } from "next/router";
import Today_highlight from "./components/Today_highlight";
import Weather_Today from "./components/Weather_Today";
import Weather_week from "./components/Weather_week";
import searchimageurl from "../public/search.gif";

const Home = () => {
  //console.log("res1 = ", results1);
  //const router = useRouter();
  const [city, setCity] = useState("");
  const [data, setData] = useState({ day: {}, week: {} });

  //for the first time
  useEffect(() => {
    (async () => {
      const url = `https://api.openweathermap.org/data/2.5/weather?q=Delhi&appid=${process.env.NEXT_PUBLIC_API_KEY_1}`;
      const res1 = await fetch(url);
      const response1 = await res1.json();
      //console.log("res1 = ",response1);

      //api-2
      const url1 = `https://api.openweathermap.org/data/2.5/forecast/daily?q=Delhi&appid=${process.env.NEXT_PUBLIC_API_KEY_1}`;
      const res2 = await fetch(url1);
      const response2 = await res2.json();
      //console.log("res2 = ",response2);

      setData({ day: response1, week: response2 });
    })();
  }, []);

  const handleChange = (e) => {
    setCity(e.target.value);
    //console.log(city)
  };

  const handleSubmit = async (e) => {
    //console.log("%c ClickSubmit","font-size:12px; color:green; padding:10px;")
    //console.log("city = ", city);
    //router.push(`/?term=${city}`);

    const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${process.env.NEXT_PUBLIC_API_KEY_1}`;
    const res = await fetch(url);
    const data1 = await res.json();
    //console.log(data1);

    //api-2
    const url1 = `https://api.openweathermap.org/data/2.5/forecast/daily?q=${city}&appid=${process.env.NEXT_PUBLIC_API_KEY_1}`;
    const res1 = await fetch(url1);
    const data2 = await res1.json();
    //console.log(data2);
    setData({ day: data1, week: data2 });
  };

  return (
    <>
      <Head>
        <title>Weather-Lytics</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      {/* input */}
      <div className="p-3 xl:p-10 flex flex-row justify-center items-center space-x-2 xl:space-x-5 bg-blue-900">
        <div className="bg-lime-300 border-2 border-stone-700 rounded-full ">
          <input
            className="w-full rounded-full p-2 xl:p-4 text-base xl:text-3xl text-blue-800 font-bold active:rounded-full "
            value={city}
            placeholder="Enter city"
            onChange={handleChange}
          />
        </div>
        <div>
          <button className="p-1 m-auto p-auto" onClick={() => handleSubmit()}>
            <div className="w-14 h-14 xl:w-16 xl:h-16 p-2 rounded-full bg-pink-400 border-2 hover:bg-pink-600 border-white">
              <Image
                src={searchimageurl}
                layout="responsive"
                alt="Search_icon"
                className=" rounded-full p-3 bg-blue-900 "
              />
            </div>
          </button>
        </div>
      </div>

      <div className="min-h-full bg-red-200 flex flex-col lg:flex-row ">
        <div className="bg-blue-300 w-full lg:w-1/4 lg:h-full xl:m-4 xl:rounded-3xl">
          <Weather_Today results={data.day} />
        </div>
        <div className="bg-green-200 w-full lg:h-full ">
          <div className="min-h-full flex flex-col">
            <div className="bg-yellow-400 w-full ">
              <Today_highlight results={data.day} />
            </div>
            <div className="bg-orange-600 xl:m-5">
              <Weather_week results1={data.week} />
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

// export async function getServerSideProps({ query }) {
//   // if there is no query
//   if (!query.term) query.term = "Bhopal";

//   //api-1
//   const url = `https://api.openweathermap.org/data/2.5/weather?q=${query.term}&appid=${process.env.NEXT_PUBLIC_API_KEY_1}`;
//   const res = await fetch(url);
//   const data = await res.json();
//   //console.log(data);

//   //api-2
//   const url1 = `http://api.openweathermap.org/data/2.5/forecast/daily?q=${query.term}&appid=${process.env.NEXT_PUBLIC_API_KEY_1}`;
//   const res1 = await fetch(url1);
//   const data1 = await res1.json();
//   //console.log(data1);

//   return {
//     props: {
//       results: data,
//       results1: data1,
//     },
//   };
// }
export default Home;